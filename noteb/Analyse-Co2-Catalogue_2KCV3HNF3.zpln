{
  "paragraphs": [
    {
      "text": "%pyspark\n\nfrom pyspark.sql import SparkSession\nfrom pyspark.sql import functions as F\nfrom pyspark.sql.functions import avg, when, trim, split, regexp_replace, round, lower, col\n\nspark = SparkSession.builder\\\n    .appName(\"Analyse de Co2 et Catalogue\") \\\n    .config('hive.metastore.warehouse.dir', '/user/hive/warehouse') \\\n    .config('hive.metastore.uris', 'thrift://hive-metastore:9083') \\\n    .enableHiveSupport()\\\n    .getOrCreate()",
      "user": "anonymous",
      "dateUpdated": "2024-11-12T17:52:51+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "colWidth": 12,
        "editorMode": "ace/mode/python",
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1731432604460_1764364349",
      "id": "paragraph_1731423352872_1264454946",
      "dateCreated": "2024-11-12T17:30:04+0000",
      "dateStarted": "2024-11-12T17:52:51+0000",
      "dateFinished": "2024-11-12T17:52:51+0000",
      "status": "FINISHED",
      "focus": true,
      "$$hashKey": "object:4893"
    },
    {
      "title": "Import  catalogue",
      "text": "%pyspark\nspark.sparkContext.setLogLevel(\"OFF\")\nspark.catalog.clearCache()\nspark.sql(\"USE concessionnaire\")\n\ndf_catalogue = spark.sql(\"SELECT * FROM catalogue_ext\")\ndf_co2 = spark.sql(\"SELECT * FROM crit_air_ext\")\n\ndf_catalogue = df_catalogue.filter(df_catalogue['marque'] != 'marque') # A GERER DANS L'IMPORT DE HIVE ???",
      "user": "anonymous",
      "dateUpdated": "2024-11-12T17:52:51+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "colWidth": 12,
        "editorMode": "ace/mode/python",
        "fontSize": 9,
        "title": true,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1731432604460_1280392452",
      "id": "paragraph_1731423663605_176002507",
      "dateCreated": "2024-11-12T17:30:04+0000",
      "dateStarted": "2024-11-12T17:52:51+0000",
      "dateFinished": "2024-11-12T17:52:54+0000",
      "status": "FINISHED",
      "$$hashKey": "object:4894"
    },
    {
      "text": "%pyspark\ndf_catalogue.show()\ndf_co2.show()",
      "user": "anonymous",
      "dateUpdated": "2024-11-12T17:52:54+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "colWidth": 12,
        "editorMode": "ace/mode/python",
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "TEXT",
            "data": "+----------+--------------+---------+-----------+--------+--------+-------+--------+-------+\n|    marque|           nom|puissance|   longueur|nbplaces|nbportes|couleur|occasion|   prix|\n+----------+--------------+---------+-----------+--------+--------+-------+--------+-------+\n|     Volvo|        S80 T6|      272|tr�s longue|       5|       5|  blanc|   false|50500.0|\n|     Volvo|        S80 T6|      272|tr�s longue|       5|       5|   noir|   false|50500.0|\n|     Volvo|        S80 T6|      272|tr�s longue|       5|       5|  rouge|   false|50500.0|\n|     Volvo|        S80 T6|      272|tr�s longue|       5|       5|   gris|    true|35350.0|\n|     Volvo|        S80 T6|      272|tr�s longue|       5|       5|   bleu|    true|35350.0|\n|     Volvo|        S80 T6|      272|tr�s longue|       5|       5|   gris|   false|50500.0|\n|     Volvo|        S80 T6|      272|tr�s longue|       5|       5|   bleu|   false|50500.0|\n|     Volvo|        S80 T6|      272|tr�s longue|       5|       5|  rouge|    true|35350.0|\n|     Volvo|        S80 T6|      272|tr�s longue|       5|       5|  blanc|    true|35350.0|\n|     Volvo|        S80 T6|      272|tr�s longue|       5|       5|   noir|    true|35350.0|\n|Volkswagen|Touran 2.0 FSI|      150|     longue|       7|       5|  rouge|   false|27340.0|\n|Volkswagen|Touran 2.0 FSI|      150|     longue|       7|       5|   gris|    true|19138.0|\n|Volkswagen|Touran 2.0 FSI|      150|     longue|       7|       5|   bleu|    true|19138.0|\n|Volkswagen|Touran 2.0 FSI|      150|     longue|       7|       5|   gris|   false|27340.0|\n|Volkswagen|Touran 2.0 FSI|      150|     longue|       7|       5|   bleu|   false|27340.0|\n|Volkswagen|Touran 2.0 FSI|      150|     longue|       7|       5|  blanc|    true|19138.0|\n|Volkswagen|Touran 2.0 FSI|      150|     longue|       7|       5|   noir|    true|19138.0|\n|Volkswagen|Touran 2.0 FSI|      150|     longue|       7|       5|  rouge|    true|19138.0|\n|Volkswagen|Touran 2.0 FSI|      150|     longue|       7|       5|  blanc|   false|27340.0|\n|Volkswagen|Touran 2.0 FSI|      150|     longue|       7|       5|   noir|   false|27340.0|\n+----------+--------------+---------+-----------+--------+--------+-------+--------+-------+\nonly showing top 20 rows\n\n+--------------------+-----------+----------+------------+\n|       marque_modele|bonus_malus|rejets_co2|cout_energie|\n+--------------------+-----------+----------+------------+\n|AUDI E-TRON SPORT...|  -6 000€ 1|       0.0|       356 €|\n|  RENAULT ZOE (53Kw)|  -6 000€ 1|       0.0|       206 €|\n|NISSAN NV400 COMB...|    +8 753€|     200.0|       810 €|\n|TOYOTA PRIUS Hybr...|          -|      32.0|        43 €|\n|NISSAN NV400 COMB...|    +8 753€|     200.0|       810 €|\n|    BMW 745Le xDrive|          -|      55.0|        62 €|\n|VOLVO V60 T8 Twin...|          -|      39.0|        64 €|\n|       BMW i3 120 Ah|  -6 000€ 1|       0.0|       204 €|\n|VOLVO V90 T8 Twin...|          -|      40.0|        78 €|\n|MERCEDES SPRINTER...|    +8 753€|     200.0|       799 €|\n|NISSAN NV400 COMB...|    +8 753€|     200.0|       810 €|\n|MERCEDES SPRINTER...|    +8 753€|     232.0|       925 €|\n|MERCEDES SPRINTER...|    +8 753€|     210.0|       841 €|\n|NISSAN NV400 COMB...|    +8 753€|     200.0|       810 €|\n|BMW 225xe Active ...|          -|      52.0|        80 €|\n|MERCEDES SPRINTER...|    +8 753€|     210.0|       841 €|\n|PEUGEOT 508 2.0 P...|          -|      31.0|        67 €|\n|   MERCEDES E 300 de|          -|      38.0|        78 €|\n|PORSCHE PANAMERA ...|          -|      72.0|        84 €|\n|MERCEDES SPRINTER...|    +8 753€|     200.0|       799 €|\n+--------------------+-----------+----------+------------+\nonly showing top 20 rows\n\n"
          }
        ]
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1731432604461_1225218557",
      "id": "paragraph_1731424000029_1950974330",
      "dateCreated": "2024-11-12T17:30:04+0000",
      "dateStarted": "2024-11-12T17:52:54+0000",
      "dateFinished": "2024-11-12T17:53:19+0000",
      "status": "FINISHED",
      "$$hashKey": "object:4895"
    },
    {
      "text": "%md\n### Remarque 001\n\n- **co2** dispose de marque et modele dans la meme colone\n- La colone **nom** du catalogue n'est pas nommée **modele** dans dans **co2**\n- La colone **modele** dans les 2 tableaux n'ont pas la meme casse.\n- La colone **marque** dans les 2 tableaux n'ont pas la meme casse.\n- Le signe **€** est mentionné dans la colone **bonus_malus** de co2.\n- Le signe **€** est mentionné dans la colone **cout_energie** de co2.\n- Le chiffre 1 peut apparaitre après le signe **€** dans la colone **bonus_malus** de co2.\n\n",
      "user": "anonymous",
      "dateUpdated": "2024-11-12T17:54:23+0000",
      "progress": 0,
      "config": {
        "tableHide": false,
        "editorSetting": {
          "language": "markdown",
          "editOnDblClick": true,
          "completionKey": "TAB",
          "completionSupport": false
        },
        "colWidth": 12,
        "editorMode": "ace/mode/markdown",
        "fontSize": 9,
        "editorHide": true,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<div class=\"markdown-body\">\n<h3>Remarque 001</h3>\n<ul>\n<li><strong>co2</strong> dispose de marque et modele dans la meme colone</li>\n<li>La colone <strong>nom</strong> du catalogue n&rsquo;est pas nommée <strong>modele</strong> dans dans <strong>co2</strong></li>\n<li>La colone <strong>modele</strong> dans les 2 tableaux n&rsquo;ont pas la meme casse.</li>\n<li>La colone <strong>marque</strong> dans les 2 tableaux n&rsquo;ont pas la meme casse.</li>\n<li>Le signe <strong>€</strong> est mentionné dans la colone <strong>bonus_malus</strong> de co2.</li>\n<li>Le signe <strong>€</strong> est mentionné dans la colone <strong>cout_energie</strong> de co2.</li>\n<li>Le chiffre 1 peut apparaitre après le signe <strong>€</strong> dans la colone <strong>bonus_malus</strong> de co2.</li>\n</ul>\n\n</div>"
          }
        ]
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1731433102111_441750135",
      "id": "paragraph_1731433102111_441750135",
      "dateCreated": "2024-11-12T17:38:22+0000",
      "dateStarted": "2024-11-12T17:54:23+0000",
      "dateFinished": "2024-11-12T17:54:23+0000",
      "status": "FINISHED",
      "$$hashKey": "object:4896"
    },
    {
      "text": "%pyspark\n# co2 dispose de marque et modele dans la meme colone\ndf_co2 = df_co2.withColumn(\"marque\", split(df_co2[\"marque_modele\"], \" \", 2).getItem(0))\ndf_co2 = df_co2.withColumn(\"modele\", split(df_co2[\"marque_modele\"], \" \", 2).getItem(1))\ndf_co2 = df_co2.drop('marque_modele')\n# Terminer\n\n# La colone **nom** du catalogue n'est pas nommée **modele** dans dans **co2**\ndf_catalogue = df_catalogue.withColumnRenamed(\"nom\", \"modele\")\n# Terminer\n\n# La colone modele dans les 2 tableaux n’ont pas la meme casse.\ndf_co2 = df_co2.withColumn(\"marque\", lower(trim(col(\"marque\"))))\ndf_catalogue = df_catalogue.withColumn(\"marque\", lower(trim(col(\"marque\"))))\n# Terminer\n\n# La colone modele dans les 2 tableaux n’ont pas la meme casse.\ndf_co2 = df_co2.withColumn(\"modele\", lower(trim(col(\"modele\"))))\ndf_catalogue = df_catalogue.withColumn(\"modele\", lower(trim(col(\"modele\"))))\n# Terminer",
      "user": "anonymous",
      "dateUpdated": "2024-11-12T17:53:19+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "colWidth": 12,
        "editorMode": "ace/mode/python",
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1731432604461_988327468",
      "id": "paragraph_1731424289856_456957682",
      "dateCreated": "2024-11-12T17:30:04+0000",
      "dateStarted": "2024-11-12T17:53:19+0000",
      "dateFinished": "2024-11-12T17:53:19+0000",
      "status": "FINISHED",
      "$$hashKey": "object:4897"
    },
    {
      "text": "%pyspark\ndf_co2.show()\ndf_catalogue.show()",
      "user": "anonymous",
      "dateUpdated": "2024-11-12T17:53:19+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "colWidth": 12,
        "editorMode": "ace/mode/python",
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "TEXT",
            "data": "+-----------+----------+------------+--------+--------------------+\n|bonus_malus|rejets_co2|cout_energie|  marque|              modele|\n+-----------+----------+------------+--------+--------------------+\n|  -6 000€ 1|       0.0|       356 €|    audi|e-tron sportback ...|\n|  -6 000€ 1|       0.0|       206 €| renault|          zoe (53kw)|\n|    +8 753€|     200.0|       810 €|  nissan|nv400 combi 3t5 9...|\n|          -|      32.0|        43 €|  toyota|prius hybride rec...|\n|    +8 753€|     200.0|       810 €|  nissan|nv400 combi 3t3 9...|\n|          -|      55.0|        62 €|     bmw|        745le xdrive|\n|          -|      39.0|        64 €|   volvo|v60 t8 twin engin...|\n|  -6 000€ 1|       0.0|       204 €|     bmw|           i3 120 ah|\n|          -|      40.0|        78 €|   volvo|v90 t8 twin engin...|\n|    +8 753€|     200.0|       799 €|mercedes|sprinter combi 31...|\n|    +8 753€|     200.0|       810 €|  nissan|nv400 combi 3t5 8...|\n|    +8 753€|     232.0|       925 €|mercedes|sprinter combi 31...|\n|    +8 753€|     210.0|       841 €|mercedes|sprinter combi 31...|\n|    +8 753€|     200.0|       810 €|  nissan|nv400 combi 3t3 8...|\n|          -|      52.0|        80 €|     bmw| 225xe active tourer|\n|    +8 753€|     210.0|       841 €|mercedes|sprinter combi 31...|\n|          -|      31.0|        67 €| peugeot|508 2.0 puretech ...|\n|          -|      38.0|        78 €|mercedes|            e 300 de|\n|          -|      72.0|        84 €| porsche|panamera turbo s ...|\n|    +8 753€|     200.0|       799 €|mercedes|sprinter combi 31...|\n+-----------+----------+------------+--------+--------------------+\nonly showing top 20 rows\n\n+----------+--------------+---------+-----------+--------+--------+-------+--------+-------+\n|    marque|        modele|puissance|   longueur|nbplaces|nbportes|couleur|occasion|   prix|\n+----------+--------------+---------+-----------+--------+--------+-------+--------+-------+\n|     volvo|        s80 t6|      272|tr�s longue|       5|       5|  blanc|   false|50500.0|\n|     volvo|        s80 t6|      272|tr�s longue|       5|       5|   noir|   false|50500.0|\n|     volvo|        s80 t6|      272|tr�s longue|       5|       5|  rouge|   false|50500.0|\n|     volvo|        s80 t6|      272|tr�s longue|       5|       5|   gris|    true|35350.0|\n|     volvo|        s80 t6|      272|tr�s longue|       5|       5|   bleu|    true|35350.0|\n|     volvo|        s80 t6|      272|tr�s longue|       5|       5|   gris|   false|50500.0|\n|     volvo|        s80 t6|      272|tr�s longue|       5|       5|   bleu|   false|50500.0|\n|     volvo|        s80 t6|      272|tr�s longue|       5|       5|  rouge|    true|35350.0|\n|     volvo|        s80 t6|      272|tr�s longue|       5|       5|  blanc|    true|35350.0|\n|     volvo|        s80 t6|      272|tr�s longue|       5|       5|   noir|    true|35350.0|\n|volkswagen|touran 2.0 fsi|      150|     longue|       7|       5|  rouge|   false|27340.0|\n|volkswagen|touran 2.0 fsi|      150|     longue|       7|       5|   gris|    true|19138.0|\n|volkswagen|touran 2.0 fsi|      150|     longue|       7|       5|   bleu|    true|19138.0|\n|volkswagen|touran 2.0 fsi|      150|     longue|       7|       5|   gris|   false|27340.0|\n|volkswagen|touran 2.0 fsi|      150|     longue|       7|       5|   bleu|   false|27340.0|\n|volkswagen|touran 2.0 fsi|      150|     longue|       7|       5|  blanc|    true|19138.0|\n|volkswagen|touran 2.0 fsi|      150|     longue|       7|       5|   noir|    true|19138.0|\n|volkswagen|touran 2.0 fsi|      150|     longue|       7|       5|  rouge|    true|19138.0|\n|volkswagen|touran 2.0 fsi|      150|     longue|       7|       5|  blanc|   false|27340.0|\n|volkswagen|touran 2.0 fsi|      150|     longue|       7|       5|   noir|   false|27340.0|\n+----------+--------------+---------+-----------+--------+--------+-------+--------+-------+\nonly showing top 20 rows\n\n"
          }
        ]
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1731432604461_311929945",
      "id": "paragraph_1731424290117_658861203",
      "dateCreated": "2024-11-12T17:30:04+0000",
      "dateStarted": "2024-11-12T17:53:19+0000",
      "dateFinished": "2024-11-12T17:53:24+0000",
      "status": "FINISHED",
      "$$hashKey": "object:4898"
    },
    {
      "text": "%pyspark\nspark.stop()\n",
      "user": "anonymous",
      "dateUpdated": "2024-11-12T17:53:24+0000",
      "progress": 0,
      "config": {
        "colWidth": 12,
        "fontSize": 9,
        "results": {},
        "enabled": true,
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "editorMode": "ace/mode/python"
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1731432604461_783200788",
      "id": "paragraph_1731424290620_1380668737",
      "dateCreated": "2024-11-12T17:30:04+0000",
      "dateStarted": "2024-11-12T17:53:24+0000",
      "dateFinished": "2024-11-12T17:53:25+0000",
      "status": "FINISHED",
      "$$hashKey": "object:4899"
    }
  ],
  "name": "Analyse-Co2-Catalogue",
  "id": "2KCV3HNF3",
  "defaultInterpreterGroup": "spark",
  "version": "0.10.0",
  "noteParams": {},
  "noteForms": {},
  "angularObjects": {},
  "config": {
    "isZeppelinNotebookCronEnable": false,
    "looknfeel": "default",
    "personalizedMode": "false"
  },
  "info": {
    "isRunning": false
  },
  "path": "/Analyse-Co2-Catalogue"
}